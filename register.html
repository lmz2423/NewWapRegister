<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <!--不准对数字进行电话侦测-->
    <meta content=”telephone=no” name=”format-detection”/>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no,width=device-width"/>
    <title>宜人贷注册</title>
    <link rel="stylesheet" href="css/reset.css"/>
    <style type="text/css">
        html, body {
            font-size: 62.5%;
        }

        .content {
            max-width: 420px;
            margin: 0 auto;
            background: #ffffff;
            font-family: '微软雅黑' 'Microsoft YaHei' \5FAE\8F6F\96C5\9ED1;
        }

        #logo {
            width: 100%;
            height: auto;
        }

        .main_text {
            padding: 1.1rem 3.65%;
        }

        .main_text:after {
            display: block;
            content: '';
            visibility: hidden;
            clear: both;
        }

        .introduce, a.a_link {
            display: block;
            font-family: '微软雅黑' 'Microsoft YaHei' \5FAE\8F6F\96C5\9ED1;
            font-size: 1.2rem;
            font-weight: normal;
        }

        strong.part2 {
            margin-top: 9px;
        }

        strong:nth-child(5) {
            margin-bottom: 10px;
            float: left;

        }

        a.a_link {
            float: right;
            color: #7690ab;
            text-decoration: underline;
        }

        .downTrips {
            margin-bottom: 6px;
            font-size: 1.4rem;
            text-align: center;
            color: #336699;
        }

        input[type="button"] {
            display: block;
            margin: 0 auto;

            border: 0px;
            background: #ef5959;
            color: #ffffff;
            height: 36px;
            width: 71.875%;
            font-size: 1.5rem;
        }

        .sectionPart2 {
            margin-top: 26px;
            position: relative;
        }

        /*注册表单*/
        #register {
            height: 37px;
            line-height: 37px;
            background: #f2f2f2;
            color: #919191;
            font-size: 1.5rem;
            text-align: center;

        }

        #error_trips {
            color: rgb(255, 0, 0);
            font-size: 1.4rem;
            display: block;
            position: absolute;
            left: 3.75%;
        }

        .formBlock {
            margin: 24px 3.75% 12px 3.75%;
        }

        .iphoneNumber, .codeTextOne, .codeTextTwo, .message, .password, .imgCode, .zhuce {
            display: block;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            height: 36px;
            font-size: 1.4rem;
        }

        .iphoneNumber, .codeTextOne, .codeTextTwo, .message, .password, .imgCode {
            margin-bottom: 9px;
        }

        .iphoneNumber, .password {
            width: 100%;
            border: 1px solid #b4b4b4;
            padding-left: 10px;
        }

        .message, .imgCode {
            float: left;
            width: 26.63%;
            line-height: 36px;
            text-align: center;
            background: #c1c1c1;
            color: #5f5f5f;
        }

        .codeTextOne, .codeTextTwo {
            width: 69.27%;
            float: right;
            padding-left: 8px;
            border: 1px solid #b4b4b4;
        }

        .zhuce {
            border: 0px;
            margin: 0 auto;
            background: #829ebb;
            color: #e4e9ef;
            width: 58.3%;
        }

        /*隐藏的*/
        .hide {
            display: none;
        }

        .focus {
            border: 1px solid red;
            color: red;
        }

        @media only screen and (min-width: 340px ) and (max-width: 400px)  and (-webkit-min-device-pixel-ratio: 1.5) {
            .introduce, a.a_link {
                font-size: 1.4rem;
            }

            strong.part2 {
                margin-top: 11px;
            }

            strong:nth-child(5) {
                margin-bottom: 12px;
            }

            .downTrips {
                margin-bottom: 9px;
                font-size: 1.5rem;
            }

            input[type='button'] {
                height: 40px;
                font-size: 1.7rem;
            }

            .sectionPart2 {
                margin-top: 30px;
            }

            #register {
                height: 40px;
                line-height: 40px;
                font-size: 1.7rem;
            }

            .formBlock {
                margin: 14px 3.75%;
            }
        }
    </style>
</head>
<body>
<div class="content">
    <img src="image/logo.png" id="logo"/>
    <!--主要内容，强调-->
    <main class="main_text">
        <strong class="introduce">"宜人贷"是宜信公司推出的无抵押网络借款咨询服务平台</strong>
        <strong class="introduce">最高可贷50万 最快当天放款</strong>
        <strong class="introduce part2">符合以下条件即可申请: </strong>
        <strong class="introduce">年龄：22周岁（含）至55周岁之间</strong>
        <strong class="introduce">月薪：4000元（税后）人民币以上</strong><a class="a_link">更多</a>
    </main>

    <section>
        <p class="downTrips">下载客户端体验快速放款绿色通道</p>
        <input type="button" value="立即下载宜人贷客户端" data-value="buttonDown">
    </section>
    <!--注册宜人贷-->
    <section class="sectionPart2">
        <p id="register">注册宜人贷借款</p>
        <span id="error_trips"></span>

        <form method="post" action="register.html" class="formBlock">
            <input type="text" placeholder="手机号" class="iphoneNumber" data-value="iphone">
            <span class="message hide">获取验证码</span><input type="text" placeholder="请输入验证码" class="codeTextOne hide"
                                                          data-value="messageValue">
            <input type="text" placeholder="密码6-16字符" class="password" data-value="passwordValue">
            <img src="" alt="图形验证码" title="图形验证码" class="imgCode"><input type="text" placeholder="请输入验证码"
                                                                         class="codeTextTwo" data-value="imageValue">
            <input type="submit" value="注册" class="zhuce">
        </form>
    </section>
    <section>
        <p class="downTrips">通过宜人贷借款客户端提交申请，优先审核</p>
        <input type="button" value="立即下载宜人贷客户端" data-value="buttonDown">
        <a href="www.yirendai.com" class="a_linkWeb">宜人贷www.yirendai.com</a>
    </section>
    <section>

    </section>
</div>
<script type="text/javascript" src="js/zepto.js"></script>
<script>
(function () {

    'use strict';
    var submitBock = $(".formBlock"),
            submitBockOne = document.querySelector(".formBlock"),
            iphoneNumberValue = document.querySelector(".iphoneNumber"),
            mgCodeSpan = $(".message"),
            mgCodeValue = document.querySelector(".codeTextOne"),
            psswordValue = document.querySelector(".password"),
            imgCodeSpan = $(".imgCode"),
            errorText = $("#error_trips"),
            imgCodeValue = document.querySelector(".codeTextTwo"),
            timeOut = 60,
            is_hide = true;

    //判断事件
    var errorTextConfig = {
        iphone: {
            empty: "手机号码不能为空！",
            errorRule: "手机号码不符合规则！"
        },
        password: {
            empty: "密码不能为空！",
            errorRule: "密码长度应在6-16之间！"
        },
        imgCode: {
            empty: "图片验证码不能为空！",
            errorRule: "图片验证码错误"
        },
        mgCode: {
            empty: "短信验证码不能为空！",
            errorRule: "短信验证码错误！"
        }
    };

    function changeText() {
        var time = setInterval(function () {
            mgCodeSpan.text(timeOut + "s后重发");
            timeOut = timeOut - 1;
            if (timeOut < 0) {
                clearInterval(time);
                mgCodeSpan.text("重新发送");
            }
        }, 1000);
    }


    //重新获取验证码
    function getSmsCodeAgain(mobile) {
        $.ajax({
            url: "{:U('WebCard/ajaxGetCode')}",
            data: {"mobile": mobile},
            dataType: 'json',
            type: 'post',
            success: function (obj) {
                if (obj.code != 200) {
                    alert(obj.msg);
                }
            }
        });
    }

    //发送验证码
    mgCodeSpan.on("click", function () {
        if (timeOut <= 0) {
            timeOut = 60;
            changeText();
            getSmsCodeAgain('{$post.userName}');
        }
    });

    //刷新图形验证码
    imgCodeSpan.on('click', function () {
        $.ajax({
            url: "xx",
            data: {"xx": "xx"},
            dataType: 'json',
            type: 'post',
            success: function (data) {
                imgCodeSpan.attr("src", data.url);
            }
        });
    });


    //提交表单
    submitBock.on("submit", function (e) {
        var errorArray = new Array();
        errorArray[0] = new Array();
        errorArray[1] = new Array();
        e.preventDefault();
        var iphoneValue = iphoneNumberValue.value.trim(),
                mgCodeValueText = mgCodeValue.value,
                passwordValueText = psswordValue.value,
                imgValueText = imgCodeValue.value.trim();
        if (iphoneValue.length === 0) {
            errorArray[0].push(iphoneNumberValue);
            errorArray[1].push(errorTextConfig.iphone.empty);
        }
        if (!(/^1[3|4|5|8|7][0-9]\d{4,8}$/.test(iphoneValue)) || (iphoneValue.length > 0 && iphoneValue.length !== 11 )) {
            iphoneNumberValue.focus();
            errorArray[0].push(iphoneNumberValue);
            errorArray[1].push(errorTextConfig.iphone.errorRule);
        }
        if (mgCodeValueText.trim() === "") {
            errorArray[0].push(mgCodeValue);
            errorArray[1].push(errorTextConfig.mgCode.empty)
        }
        if (passwordValueText === "") {
            errorArray[0].push(psswordValue);
            errorArray[1].push(errorTextConfig.password.empty);
        }

        if (passwordValueText.length < 6 || passwordValueText.length > 16) {
            errorArray[0].push(psswordValue);
            errorArray[1].push(errorTextConfig.password.errorRule);
        }
        if (imgValueText === '') {
            errorArray[0].push(imgCodeValue);
            errorArray[1].push(errorTextConfig.imgCode.empty)
        }
        var i = 0, length = errorArray[0].length;
        for (i; i < length; i = i + 1) {
            errorArray[0][0].focus();
            errorArray[0][i].classList.add("focus");
            errorText.text(errorArray[1][0]);
        }

        if (length > 0) {
            e.preventDefault();
        }
        else {
            $.ajax({
                url: "url",
                data: {},
                dataType: 'json',
                type: 'post',
                success: function (obj) {
                    //
                }
            })
        }
        ;
    });


    submitBockOne.addEventListener("focus", function (e) {
        e.target.classList.add("focus");
        if (e.target.getAttribute("data-value") === "passwordValue") {
            e.target.setAttribute("type", "password");
        }
        if (e.target.getAttribute("type") === 'submit') {
            e.target.classList.remove("focus");
        }
    }, true);
    submitBockOne.addEventListener("blur", function (e) {
        e.target.classList.remove('focus');
        if (e.target.getAttribute("data-value") === "passwordValue") {
            if (e.target.value === "") {
                e.target.setAttribute("type", "text");
            }
        }
    }, true);

    //展开验证码
    iphoneNumberValue.addEventListener('keyup', function (e) {
        var iphoneValue = iphoneNumberValue.value.trim();
        if ((/^1[3|4|5|8|7][0-9]\d{4,8}$/.test(iphoneValue)) && iphoneValue.length === 11) {
            if (is_hide) {
                mgCodeSpan.removeClass('hide');
                mgCodeValue.classList.remove('hide');
                mgCodeValue.focus();
                is_hide = false;
                changeText();
                getSmsCodeAgain('{$post.userName}');
            }
        }
    });
    mgCodeValue.addEventListener('keyup', function (e) {
        if (e.keyCode === 13) {
            if (psswordValue.value === "" && imgCodeValue.value === "") {
                e.preventDefault();
                e.stopPropagation();
                psswordValue.focus();
            }
        }
    });

    //

//        document.addEventListener("keyup", function (event) {
//            //是按了enter键
//            if (event.keyCode === 13) {
//                if (event.target.getAttribute("data-value") === 'iphone') {
//
//                    var iphoneValue = $.trim(iphoneNumberValue.val());
////                    if (!(/^1[3|4|5|8|7][0-9]\d{4,8}$/.test(iphoneValue))) {
////                        alert("xx");
////                        errorText.text(errorTextConfig.iphone.errorRule);
////                        event.preventDefault();
////                    }
////                    else
//                    if (iphoneValue.length === 0) {
//                        errorText.text(errorTextConfig.iphone.empty);
//                        event.preventDefault();
//                    }
//                    else if (iphoneValue.length !== 11) {
//                        errorText.text(errorTextConfig.iphone.errorRule);
//                        event.preventDefault();
//                    }
//                }
//            }
//        });
}());
</script>
</body>

</html>
